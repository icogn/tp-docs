<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-save-file/memory-card">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Memory Card | TP Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://icogn.github.io/tp-docs/docs/save-file/memory-card"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Memory Card | TP Docs"><meta data-rh="true" name="description" content="Here we discuss the Twilight Princess save file structure on the memory card at a high level."><meta data-rh="true" property="og:description" content="Here we discuss the Twilight Princess save file structure on the memory card at a high level."><link data-rh="true" rel="icon" href="/tp-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://icogn.github.io/tp-docs/docs/save-file/memory-card"><link data-rh="true" rel="alternate" href="https://icogn.github.io/tp-docs/docs/save-file/memory-card" hreflang="en"><link data-rh="true" rel="alternate" href="https://icogn.github.io/tp-docs/docs/save-file/memory-card" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/tp-docs/blog/rss.xml" title="TP Docs RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/tp-docs/blog/atom.xml" title="TP Docs Atom Feed"><link rel="stylesheet" href="/tp-docs/assets/css/styles.7afa8f30.css">
<link rel="preload" href="/tp-docs/assets/js/runtime~main.adbb371e.js" as="script">
<link rel="preload" href="/tp-docs/assets/js/main.789a4f82.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/tp-docs/"><div class="navbar__logo"><img src="/tp-docs/img/logo.svg" alt="TP Docs Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/tp-docs/img/logo.svg" alt="TP Docs Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">TP Docs</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/icogn/tp-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/tp-docs/docs/save-file/save-file-introduction">Save File Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/tp-docs/docs/save-file/memory-card">Memory Card</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/tp-docs/docs/save-file/quest-log/introduction">Quest Log</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tp-docs/docs/save-file/quest-log/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tp-docs/docs/save-file/quest-log/contents">Contents</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/tp-docs/docs/save-file/quest-log/player/player-status-a">Player</a></div></li></ul></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/tp-docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Memory Card</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Memory Card</h1><p>Here we discuss the Twilight Princess save file structure on the memory card at a high level.
If you are interested in things like rupees and poe souls, please see the <a href="/tp-docs/docs/save-file/quest-log/introduction">Quest Log</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a class="hash-link" href="#overview" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="blocks">Blocks<a class="hash-link" href="#blocks" title="Direct link to heading">​</a></h3><p>You can think of a memory card as a filesystem. Each file on the memory card is composed of a number of &quot;blocks&quot;, and each block is 0x2000 bytes long.</p><p>The first 5 blocks of a memory card are used to manage the filesystem:</p><table><thead><tr><th>Offset</th><th>Size</th><th>Description</th></tr></thead><tbody><tr><td>0x0000</td><td>0x2000</td><td>Header</td></tr><tr><td>0x2000</td><td>0x2000</td><td>Directory</td></tr><tr><td>0x4000</td><td>0x2000</td><td>Directory (backup)</td></tr><tr><td>0x6000</td><td>0x2000</td><td>Block Allocation Map</td></tr><tr><td>0x8000</td><td>0x2000</td><td>Block Allocation Map (backup)</td></tr></tbody></table><p>A file on a memory card will consist of a certain number of blocks which are located somewhere after the first 5 filesystem blocks.</p><p>For example, TP&#x27;s save data is 4 blocks long, so these blocks might be located at offsets 0xa000, 0xc000, 0xe000, and 0x10000 on a fresh memory card, but they could also be at 0x22000, 0x24000, 0x26000, and 0x28000.</p><p>The blocks do not have to be contiguous, so the save data could also be in the blocks at offsets 0x36000, 0x20000, 0x28000, and 0x44000, but it is fine to think of them as contiguous in most cases.</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>The official memory card types are Memory Card 59, Memory Card 251, and Memory Card 1019. Do you notice a pattern?<br>
64 - 5 is 59, 256 - 5 is 251, and 1024 - 5 is 1019.</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="directoryentry">DirectoryEntry<a class="hash-link" href="#directoryentry" title="Direct link to heading">​</a></h3><p>The Directory blocks contain a list of entries which are each 0x40 bytes long. Each of these entries is referred to as a DirectoryEntry.</p><p>A DirectoryEntry contains metadata about a file on the memory card. Each DirectoryEntry points to one file, and each file is pointed to by one DirectoryEntry.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="twilight-princess-save-data">Twilight Princess Save Data<a class="hash-link" href="#twilight-princess-save-data" title="Direct link to heading">​</a></h3><p>The Twilight Princess data on the memory card is a combination of a save file (which is 4 blocks long) and its metadata (a DirectoryEntry).</p><table><thead><tr><th>Size</th><th>Description</th></tr></thead><tbody><tr><td>0x40</td><td>DirectoryEntry</td></tr><tr><td>0x8000</td><td>4 Blocks</td></tr></tbody></table><p>Note that a GCI file is exactly these two things back-to-back as shown above.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="blocks-1">Blocks<a class="hash-link" href="#blocks-1" title="Direct link to heading">​</a></h2><p>TP save data is composed of 4 blocks which are each 0x2000 bytes long:</p><table><thead><tr><th align="right">BlockNo</th><th>Description</th></tr></thead><tbody><tr><td align="right">1</td><td>Header</td></tr><tr><td align="right">2</td><td>Header (continued)</td></tr><tr><td align="right">3</td><td>Quest Log Data</td></tr><tr><td align="right">4</td><td>Quest Log Data (backup)</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="header-blocks">Header Blocks<a class="hash-link" href="#header-blocks" title="Direct link to heading">​</a></h3><p>The Header continues into the second block, so those two blocks will be treated as a chunk of 0x4000 bytes for discussion purposes. Remember that the two blocks may not actually be back-to-back on the memory card.</p><table><thead><tr><th align="right">Offset</th><th align="right">Size</th><th>Description</th></tr></thead><tbody><tr><td align="right">0x0000</td><td align="right">0xc00</td><td>Banner pixel data</td></tr><tr><td align="right">0x0c00</td><td align="right">0x200</td><td>Banner palette data</td></tr><tr><td align="right">0x0e00</td><td align="right">0x400</td><td>Icon pixel data</td></tr><tr><td align="right">0x1200</td><td align="right">0x400</td><td>Icon pixel data (copy)</td></tr><tr><td align="right">0x1600</td><td align="right">0x400</td><td>Icon pixel data (copy)</td></tr><tr><td align="right">0x1a00</td><td align="right">0x400</td><td>Icon pixel data (copy)</td></tr><tr><td align="right">0x1e00</td><td align="right">0x400</td><td>Icon pixel data (copy)</td></tr><tr><td align="right">0x2200</td><td align="right">0x200</td><td>Icon palette data</td></tr><tr><td align="right">0x2400</td><td align="right">0x20</td><td>Comment 1</td></tr><tr><td align="right">0x2420</td><td align="right">0x20</td><td>Comment 2</td></tr><tr><td align="right">0x2440</td><td align="right">0x1bc0</td><td>Unused/garbage</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="banner">Banner<a class="hash-link" href="#banner" title="Direct link to heading">​</a></h4><img loading="lazy" src="data:image/png;base64,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" alt="zelda2_gc_banner.bti" class="img_ev3q"><p>A file on the memory card can have a banner. The banner always has dimensions 0x60 by 0x20 pixels (96 x 32 decimal).</p><p>TP&#x27;s banner is in CI8 format (indicated in the DirectoryEntry) which means it uses one byte per pixel. 0x60 width <!-- -->*<!-- --> 0x20 height gives 0xc00 pixels total. At one byte per pixel, TP&#x27;s banner is 0xc00 bytes long.</p><p>If a banner is in CI8 format, the 0x200 bytes following the pixel data are allocated to store its palette data. Each palette entry is 2 bytes, meaning a CI8 banner can use up to 0x100 unique palette entries. Each byte in the pixel data has a value between 0x00 and 0xff which is an offset to an entry in the palette data.</p><p>Note that TP&#x27;s banner only makes use of the first 0x160 bytes of the palette data space.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="icons">Icons<a class="hash-link" href="#icons" title="Direct link to heading">​</a></h4><img loading="lazy" src="data:image/png;base64,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" alt="zelda2_gc_banner.bti" class="img_ev3q"><p>A file on the memory card can have between 0 and 8 icons. An icon always has dimensions 0x20 by 0x20 pixels (32 x 32 decimal). Multiple icons can be used to create an animated icon.</p><p>TP specifies in its DirectoryEntry that it has 5 icons and that each icon is in CI8 format with a shared color palette following all of the pixel data. CI8 format means each pixel takes one byte. Each icon has dimensions 0x20 by 0x20, so each icon is 0x400 bytes long.</p><p>As with the banner, the icon palette data must fit in the 0x200 bytes following the end of the pixel data. For its icons, TP makes use of the full 0x200 bytes of palette data.</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>The zelda2_gc_banner.bti and zelda2_gc_icon.bti are located in the Yaz0-encoded <code>/res/CardIcon/cardicon.arc</code>. &quot;Card&quot; here is short for Memory Card.</p></div></div><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Fun Fact</div><div class="admonitionContent_S0QG"><p>The banner and icon both have a single semi-transparent pixel (most likely mistakes).
If position x:0,y:0 is the top left pixel of the image, then the banner has this pixel at x:12,y:30, and the icon has it at x:2,y:1.</p></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="comments-1-and-2">Comments 1 and 2<a class="hash-link" href="#comments-1-and-2" title="Direct link to heading">​</a></h4><p>Each comment is a null-terminated string which can use up to 0x20 bytes.</p><p>The comments (in addition to the banner and icon) are visible when managing memory card data on your GameCube.</p><p>For the US GameCube version of TP, the first comment is always &quot;Zelda: Twilight Princess&quot;, and the second comment is something like &quot;6/26 Save Data&quot; (which is Month/Day).</p><p>Below is an image which shows the banner, icon, and comments in the Gamecube IPL.</p><img loading="lazy" src="/tp-docs/assets/images/gcIplTpNormal-968771239f75a15e80424ce0ac319d83.png" alt="zelda2_gc_banner.bti" class="img_ev3q"><h4 class="anchor anchorWithStickyNavbar_LWe7" id="unusedgarbage">Unused/Garbage<a class="hash-link" href="#unusedgarbage" title="Direct link to heading">​</a></h4><p>The last 0x1bc0 of Block 2 is not used for anything.</p><p>If you inspect memory card data for TP in a hex editor, you may see what appears to be quest log data in this space. This is a side effect of using a shared buffer for writing blocks to the memory card. The buffer is not <code>memset</code> with zeroes before constructing the Header blocks like it is before copying in Quest Log blocks.</p><ul><li>The buffer is zeroed out when you load the game.</li><li>If you tell the game to create a save file on the memory card, the buffer becomes dirty afterward.</li><li>When data is restored from the memory card for the file select screen, the buffer becomes dirty.</li></ul><p>This means the only time you can save before the buffer becomes dirty is when you tell the game to create new Twilight Princess data on the memory card.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="other-garbage">Other garbage<a class="hash-link" href="#other-garbage" title="Direct link to heading">​</a></h4><p>Other bytes which may contain garbage in the first two blocks are as follows:</p><ul><li>The last 0x40 bytes of the banner&#x27;s palette data (starting at offset 0xd60)</li><li>In each comment (offsets 0x2400 and 0x2420), the bytes which follow the null termination character of the comment</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="quest-log-blocks">Quest Log Blocks<a class="hash-link" href="#quest-log-blocks" title="Direct link to heading">​</a></h3><p>Block 3 contains the data for the 3 Quest Logs, which are the 3 files you pick between on the file select screen. Block 4 is a backup copy of block 3, so its data will normally match block 3&#x27;s exactly (assuming nothing unexpected happened during any memory card writes).</p><p>The Quest Log block structure is as follows:</p><table><thead><tr><th align="right">Offset</th><th align="right">Size</th><th>Description</th></tr></thead><tbody><tr><td align="right">0x0000</td><td align="right">0x8</td><td>00000000 00000006</td></tr><tr><td align="right">0x0008</td><td align="right">0xa94</td><td>Quest Log 1 Data</td></tr><tr><td align="right">0x0a9c</td><td align="right">0xa94</td><td>Quest Log 2 Data</td></tr><tr><td align="right">0x1530</td><td align="right">0xa94</td><td>Quest Log 3 Data</td></tr><tr><td align="right">0x1fc4</td><td align="right">0x38</td><td>Unused/garbage</td></tr><tr><td align="right">0x1ffc</td><td align="right">0x4</td><td>Checksum</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="first-8-bytes">First 8 Bytes<a class="hash-link" href="#first-8-bytes" title="Direct link to heading">​</a></h4><p>The first eight bytes are always set to:<br>
<code>00 00 00 00 00 00 00 06</code></p><p>My guess is that this is a version number for the quest log structure which was incremented during development, and they ended on 6.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="quest-log-data">Quest Log Data<a class="hash-link" href="#quest-log-data" title="Direct link to heading">​</a></h4><p>Each Quest Log&#x27;s data has the same structure. The structure is rather complex, so it is covered separately.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="unusedgarbage-1">Unused/Garbage<a class="hash-link" href="#unusedgarbage-1" title="Direct link to heading">​</a></h4><p>Note that each of the 0xa94 Quest Log Data sections contain unused/garbage bytes as well, but that is covered separately.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="checksum">Checksum<a class="hash-link" href="#checksum" title="Direct link to heading">​</a></h4><p>The checksum function runs over the first 0x1ffc bytes of the Quest Log block. The generated checksum is 4 bytes long, and it is stored as the final 4 bytes of a Quest Log block.</p><p>Here is the algorithm written in JavaScript:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">questLogBlockChecksum</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">arrBuf</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> offset</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> len</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> view </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">DataView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">arrBuf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> sum </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> negSum </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> index </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> offset</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> iterations </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> len </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword control-flow" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> iterations</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> val </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> view</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">getUint16</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    sum </span><span class="token operator" style="color:rgb(137, 221, 255)">+=</span><span class="token plain"> val</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    negSum </span><span class="token operator" style="color:rgb(137, 221, 255)">+=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">~</span><span class="token plain">val</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    negSum </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0xffff</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    index </span><span class="token operator" style="color:rgb(137, 221, 255)">+=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword control-flow" style="font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sum </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0x10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0xffff0000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> negSum</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="directoryentry-1">DirectoryEntry<a class="hash-link" href="#directoryentry-1" title="Direct link to heading">​</a></h2><p>These 0x40 bytes contain metadata about the Twilight Princess save data on the memory card. They live in a Directory block, hence the name. These are also the first 0x40 bytes of a GCI file.</p><table><thead><tr><th align="right">Offset</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td align="right">0x00</td><td>u8<!-- -->[4]</td><td>gameCode</td></tr><tr><td align="right">0x04</td><td>u8<!-- -->[2]</td><td>publisherCode</td></tr><tr><td align="right">0x06</td><td>u8</td><td>padding_06</td></tr><tr><td align="right">0x07</td><td>u8</td><td>imageFlags</td></tr><tr><td align="right">0x08</td><td>u8<!-- -->[0x20]</td><td>filename</td></tr><tr><td align="right">0x28</td><td>u32</td><td>lastModified</td></tr><tr><td align="right">0x2c</td><td>u32</td><td>imageDataOffset</td></tr><tr><td align="right">0x30</td><td>u16</td><td>iconFormats</td></tr><tr><td align="right">0x32</td><td>u16</td><td>iconAnimationSpeeds</td></tr><tr><td align="right">0x34</td><td>u8</td><td>permissions</td></tr><tr><td align="right">0x35</td><td>u8</td><td>copyCounter</td></tr><tr><td align="right">0x36</td><td>u16</td><td>firstBlockIndex</td></tr><tr><td align="right">0x38</td><td>u16</td><td>numBlocks</td></tr><tr><td align="right">0x3a</td><td>u8<!-- -->[2]</td><td>padding_38</td></tr><tr><td align="right">0x3c</td><td>u32</td><td>commentsOffset</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="gamecode">gameCode<a class="hash-link" href="#gamecode" title="Direct link to heading">​</a></h3><p><code>gameCode</code> will be one of the following depending on the game region:</p><table><thead><tr><th>gameCode</th><th>Region</th></tr></thead><tbody><tr><td>GZ2E</td><td>USA</td></tr><tr><td>GZ2J</td><td>Japan</td></tr><tr><td>GZ2P</td><td>Europe and other PAL regions such as Australia</td></tr></tbody></table><p>G is for Gamecube, Z2 is the title code for Twilight Princess, and the last character is dependent on the region as shown above.<br>
Read more about it here: <a href="https://wiki.dolphin-emu.org/index.php?title=GameIDs" target="_blank" rel="noopener noreferrer">GameIDs - Dolphin Emulator Wiki</a></p><p>These bytes are available at address 0x80000000 which is where they are copied from when creating the DirectoryEntry.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="publishercode">publisherCode<a class="hash-link" href="#publishercode" title="Direct link to heading">​</a></h3><p><code>publisherCode</code> will always be &quot;01&quot; (0x3031) which is the publisherCode for Nintendo.</p><p>These bytes are available at address 0x80000004 which is where they are copied from when creating the DirectoryEntry.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="padding_06">padding_06<a class="hash-link" href="#padding_06" title="Direct link to heading">​</a></h3><p>Unused byte which is always 0xff under normal conditions.<br>
See <a href="#why-0xff">Why is the padding 0xff?</a> for more info.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="imageflags">imageFlags<a class="hash-link" href="#imageflags" title="Direct link to heading">​</a></h3><p><code>imageFlags</code> is always 0x05 under normal conditions.</p><p>The image flags are the least significant 3 bits of the byte at offset 0x07. Bits 0 and 1 are used to indicate the banner format:</p><table><thead><tr><th>bannerFormat</th><th>Region</th></tr></thead><tbody><tr><td>00</td><td>No banner</td></tr><tr><td>01</td><td>8 bits per pixel, 16 bits per palette entry in RGB5A3</td></tr><tr><td>10</td><td>Direct color, 16 bits per pixel in RGB5A3</td></tr><tr><td>11</td><td>No banner</td></tr></tbody></table><p>For TP, this value will always be 01, meaning the banner&#x27;s palette data immediately follows its pixel data.</p><p>The third bit (bit 2) indicates the icon animation order.</p><table><thead><tr><th>iconAnimPattern</th><th>Region</th></tr></thead><tbody><tr><td>0</td><td>Loop (abcabcabc)</td></tr><tr><td>1</td><td>Bounce (abcbabcba)</td></tr></tbody></table><p>For TP, this value will always be 1.</p><p>Putting these values on top of a 0x00 byte, we get 0b00000101 or 0x05.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="filename">filename<a class="hash-link" href="#filename" title="Direct link to heading">​</a></h3><p>The filename for a TP save file is always &quot;gczelda2&quot;, which is likely short for &quot;Gamecube Zelda 2&quot;.</p><p>There are 0x20 bytes allocated for the filename, and under normal conditions any leftover bytes are set to 0x00.</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>&quot;gczelda&quot; (without the 2 on the end) is the filename for The Legend of Zelda: The Wind Waker save data.</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="lastmodified">lastModified<a class="hash-link" href="#lastmodified" title="Direct link to heading">​</a></h3><p>This is the last time the file which the DirectoryEntry points to was modified. This value is stored as the number of seconds since 2000/01/01 00:00.</p><p>This value is calculated by dividing the OSTicks returned from <code>OSGetTime</code> by 40,500,000 (OSTicks per second) then taking the lower 32 bits of the 64 bit result.</p><div><div>LastModified to Time Converter</div><input maxlength="20"><button>Convert</button><div class="outputText_F4so" style="display:none"></div><button class="swapButton_KciG">Swap</button></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="imagedataoffset">imageDataOffset<a class="hash-link" href="#imagedataoffset" title="Direct link to heading">​</a></h3><p>Offset to the image data (banner and icons) relative to the start of the file.</p><p>For TP this value is always 0 (the banner data starts at the very front of the first block).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="iconformats">iconFormats<a class="hash-link" href="#iconformats" title="Direct link to heading">​</a></h3><p>The icon formats are stored as 8 groups of 2 bits which amounts to 2 bytes total (16 bits). Each 2-bit group indicates an icon&#x27;s format as follows:</p><table><thead><tr><th>bits</th><th>Description</th></tr></thead><tbody><tr><td>00</td><td>No icon</td></tr><tr><td>01</td><td>CI8 with a shared color palette after the last icon&#x27;s pixel data</td></tr><tr><td>10</td><td>RGB5A3</td></tr><tr><td>11</td><td>CI8 with its own palette following its pixel data</td></tr></tbody></table><p>For TP <code>iconFormats</code> will always have the value 0x0155. If we convert this to binary, we get 0b0000000101010101. Grouping by 2 bits and starting from the least-significant (right) side, we get the following:</p><table><thead><tr><th>Index</th><th>0</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th></tr></thead><tbody><tr><td>Value</td><td>01</td><td>01</td><td>01</td><td>01</td><td>01</td><td>00</td><td>00</td><td>00</td></tr></tbody></table><p>Therefore TP has 5 icons which all share palette data after the 5th icon&#x27;s pixel data.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="iconanimationspeeds">iconAnimationSpeeds<a class="hash-link" href="#iconanimationspeeds" title="Direct link to heading">​</a></h3><p>The icon animation speeds are stored as 8 groups of 2 bits which amounts to 2 bytes total (16 bits). Each 2-bit group indicates how many frames an icon displays during the animation.</p><table><thead><tr><th>bits</th><th>Description</th></tr></thead><tbody><tr><td>00</td><td>No icon</td></tr><tr><td>01</td><td>4 frames</td></tr><tr><td>10</td><td>8 frames</td></tr><tr><td>11</td><td>12 frames</td></tr></tbody></table><p>For TP <code>iconAnimationSpeeds</code> will always have the value 0x0155. If we convert this to binary, we get 0b0000000101010101. Grouping by 2 bits and starting from the least-significant (right) side, we get the following:</p><table><thead><tr><th>Index</th><th>0</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th></tr></thead><tbody><tr><td>Value</td><td>01</td><td>01</td><td>01</td><td>01</td><td>01</td><td>00</td><td>00</td><td>00</td></tr></tbody></table><p>Therefore TP has 5 icons which each display for 4 frames before the next one is shown in the animation.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>Each icon has identical pixel and palette data. This gives the appearance of a single icon, but there are actually 5.</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="permissions">permissions<a class="hash-link" href="#permissions" title="Direct link to heading">​</a></h3><p>There are 3 permissions which are each 1 bit.</p><table><thead><tr><th>bit</th><th>Permission</th><th>Description</th></tr></thead><tbody><tr><td>4</td><td>No move</td><td>File cannot be moved by the IPL</td></tr><tr><td>3</td><td>No copy</td><td>File cannot be copied by the IPL</td></tr><tr><td>2</td><td>public</td><td>File can be read by any game</td></tr></tbody></table><p>TP never changes this value from the default 0x04 meaning public (only bit 2 is set).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="copycounter">copyCounter<a class="hash-link" href="#copycounter" title="Direct link to heading">​</a></h3><p><code>copyCounter</code> indicates how many times the file has been copied to a different memory card.</p><p>Starts at 0 and increments by 1.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="firstblockindex">firstBlockIndex<a class="hash-link" href="#firstblockindex" title="Direct link to heading">​</a></h3><p>The index of the first TP save data block on the memory card. This value must always be at least 0x0005 since the first 5 blocks are used to manage the filesystem.</p><p>For a GCI file, the value here is unimportant since a GCI file only contains blocks for a single game, and the blocks are always in order.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="numblocks">numBlocks<a class="hash-link" href="#numblocks" title="Direct link to heading">​</a></h3><p>The number of blocks a game uses. For TP this value is always 0x0004.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="padding_38">padding_38<a class="hash-link" href="#padding_38" title="Direct link to heading">​</a></h3><p>Two unused bytes which are both 0xff under normal conditions.<br>
See <a href="#why-0xff">Why is the padding 0xff?</a> for more info.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="commentsoffset">commentsOffset<a class="hash-link" href="#commentsoffset" title="Direct link to heading">​</a></h3><p>Offset to the comments relative to the start of the file.</p><p>For TP, this value will always be 0x00002400.</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>The 0x40 byte chunk for the comments must be contained within a single block.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="directoryentry-follow-up">DirectoryEntry Follow-up<a class="hash-link" href="#directoryentry-follow-up" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-0xff">Why is the padding 0xff?<a class="hash-link" href="#why-0xff" title="Direct link to heading">​</a></h3><p>Short version:</p><ul><li>The padding bytes are set to 0xff when the memory card is formatted.</li><li>They are never changed after that point.</li></ul><p>Longer version:</p><p>When a memory card is formatted, its Directory blocks are mostly filled with 0xff:</p><table><thead><tr><th>Offset</th><th>Size</th><th>Description</th></tr></thead><tbody><tr><td>0x0000</td><td>0x1ffa</td><td>0xff bytes</td></tr><tr><td>0x1ffa</td><td>0x0002</td><td>updateCounter</td></tr><tr><td>0x1ffc</td><td>0x0002</td><td>checksum1</td></tr><tr><td>0x1ffe</td><td>0x0002</td><td>checksum2</td></tr></tbody></table><p>That is to say, all bytes are 0xff except the last 6.</p><p>Shortly after starting up the game (before the WARNING-HEALTH AND SAFETY screen shows), the two Directory blocks are read from the memory card into RAM. When you tell TP to create save data on the memory card, a portion of this RAM is overwritten with TP DirectoryEntry data which is then copied back to the memory card.</p><p>Within the 0x40 bytes in RAM into which the TP DirectoryEntry is written, the padding bytes are never overwritten since there is nothing which needs to be stored there. This means they maintain whatever value they had on the memory card. This value is expected to always be 0xff since the only time these bytes are modified is when the memory card is formatted.</p><p>However, you can manually manipulate the memory card beforehand so that these bytes are a different value. When you create a save file, you will see that the padding bytes are not modified from whatever value they had.</p><p>Below is a memory card raw image you can download which has had its first DirectoryEntry slot filled with 0xaa (other than the first byte which needs to be 0xff):</p><p><a target="_blank" href="/tp-docs/saveData/raw/mem59_dirEntryAaBytes.USA.raw">Download mem59_dirEntryAaBytes.USA.raw</a></p><p>If you create TP save data on a memory card with that image, you will see that the padding bytes never change from 0xaa.</p><p>Note that this applies to the padding at offset 0x06 and at offset 0x3a.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="thoughts-on-lastmodified">Thoughts on lastModified<a class="hash-link" href="#thoughts-on-lastmodified" title="Direct link to heading">​</a></h3><ul><li>A time of 2136/02/07 06:28:15 would give 0xffffffff seconds after 2000/01/01 00:00. I think the only way to get your Gamecube&#x27;s date this high is to set it to 2099 and wait 30+ years. Even then, it is possible that the OSTick count returned from OSGetTime is based on a fixed clock and is not adjusted with any changes you make in the IPL (this could be tested). In any case, the clock battery would probably die before this became an issue.</li><li>The 64 bit OSTicks count wouldn&#x27;t get its sign bit set until around Sep 18, 9216 at 15:12:36.908044, so this is not worth thinking about.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="checkcardstat">CheckCardStat<a class="hash-link" href="#checkcardstat" title="Direct link to heading">​</a></h3><p>When restoring data from the memory card, one of the things TP does is run a function called <code>m_Do_MemCardRWmng::mDoMemCdRWm_CheckCardStat</code>. This runs a few checks on the loaded DirectoryEntry data. If any of these fail it is considered a fatal error, and the game will act as if you don&#x27;t have any save data on the memory card (meaning it will ask you to create save data).</p><p>Here are the checks which must always pass:</p><ul><li>imageDataOffset is 0x00000000</li><li>commentsOffset is 0x00002400</li><li>imageFlags: the least signficant 3 bits are 0b101</li><li>iconFormats is 0x0155</li><li>iconAnimationSpeeds is 0x0155</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="room-for-custom-data">Room for custom data?<a class="hash-link" href="#room-for-custom-data" title="Direct link to heading">​</a></h3><p>As discussed in <a href="#why-0xff">Why is the padding 0xff?</a>, we can manipulate the padding bytes to any value and their value will persist between saves. Are there any other places like this in the DirectoryEntry?</p><p>In <a href="#checkcardstat">CheckCardStat</a>, we determined some things which we can&#x27;t change without upsetting the game. Skipping over those and the padding, we are left with the following:</p><p>gameCode, publisherCode, upper 5 bits of imageFlags, filename, lastModified, certain permissions bits, copyCounter, firstBlockIndex, numBlocks</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="gamecode-publishercode-filename">gameCode, publisherCode, filename<a class="hash-link" href="#gamecode-publishercode-filename" title="Direct link to heading">​</a></h4><p>gameCode, publisherCode, and the filename contents up to and including the first 0x00 byte are used to locate the TP save file on the memory card, so these cannot be changed.</p><p>However, since the filename string comparison stops when it hits the first null byte, we can put whatever we want in the remaining 0x17 bytes.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="imageflags-1">imageFlags<a class="hash-link" href="#imageflags-1" title="Direct link to heading">​</a></h4><p>After the very first write, the DirectoryEntry looks like the following:</p><p><code>47 5A 32 45 30 31 FF 00 67 63 7A 65 6C 64 61 32</code><br>
<code>00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</code><br>
<code>00 00 00 00 00 00 00 00 28 69 BB 43 FF FF FF FF</code><br>
<code>00 00 00 01 04 00 00 05 00 04 FF FF FF FF FF FF</code></p><p>Most of the values are filled with defaults. This is quickly overwritten with TP-specific values:</p><p><code>47 5A 32 45 30 31 FF 05 67 63 7A 65 6C 64 61 32</code><br>
<code>00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</code><br>
<code>00 00 00 00 00 00 00 00 28 69 BB 43 00 00 00 00</code><br>
<code>01 55 01 55 04 00 00 05 00 04 FF FF 00 00 24 00</code></p><p>Initially, the imageFlags byte (offset 0x07) is set to its default value of 0. It is during the 2nd write that TP fills in the 3 important bits.</p><p>We know that the least significant 3 bits must be 0b101 for TP to accept the save file as valid. However, the top 5 bits are never checked, and they are only overwritten when they are initialized to 0. This means that we can set those 5 bits to whatever we want and they will maintain their value.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="lastmodified-1">lastModified<a class="hash-link" href="#lastmodified-1" title="Direct link to heading">​</a></h4><p>lastModified gets updated every time the save file is updated, so any data you put here will be lost.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="permissions-1">permissions<a class="hash-link" href="#permissions-1" title="Direct link to heading">​</a></h4><p>permissions is set to 0x04 (public) during the initial DirectoryEntry creation. For TP, the permissions are never changed after this point. Since only 3 of the bits on the permissions byte carry any meaning, we can do as we please with the other 5 bits.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="copycounter-1">copyCounter<a class="hash-link" href="#copycounter-1" title="Direct link to heading">​</a></h4><p>This is incremented when copying between memory cards, so there is not much point in putting anything here.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="firstblockindex-numblocks">firstBlockIndex, numBlocks<a class="hash-link" href="#firstblockindex-numblocks" title="Direct link to heading">​</a></h4><p>These are critical metadata which must not be changed.</p><p>For a GCI file, firstBlockIndex is irrelevant so it can be changed, but its value will be lost if it gets imported to a memory card.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="summary">Summary<a class="hash-link" href="#summary" title="Direct link to heading">​</a></h4><p>We can put whatever data we want at the following locations with no adverse effects:</p><ul><li>padding_06 which is 1 byte</li><li>Unused 5 bits in imageFlags</li><li>0x17 (23 decimal) bytes following the filename&#x27;s null termination byte</li><li>Unused 5 bits in permissions</li><li>padding_3a which is 2 bytes</li></ul><p>These gives us a total of 26 bytes and 10 bits.</p><p>Below is a memory card raw image which has had these locations in the DirectoryEntry modified. TP will recognize the save file and everything will behave normally from a memory card perspective. The custom data in the DirectoryEntry will be maintained even if you save the game.</p><p><a target="_blank" href="/tp-docs/saveData/raw/mem59_tpCustomDataDirEntry.raw">Download mem59_tpCustomDataDirEntry.raw</a></p><p>Note that you will lose some of the data if you transfer the TP save file between memory cards using the Gamecube IPL:</p><ul><li>Padding bytes are not copied.</li><li>Any bytes in the filename after the null termination byte are lost.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="other-formats">Other Formats<a class="hash-link" href="#other-formats" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="gcis">GCIs<a class="hash-link" href="#gcis" title="Direct link to heading">​</a></h3><p>You can think of a GCI as a portable version of a game&#x27;s data on a memory card.</p><ul><li>A Twilight Princess GCI file is 0x8040 bytes long and is simply the DirectoryEntry (0x40 bytes) followed by the 4 Blocks (0x8000 bytes).</li><li>The value of the DirectoryEntry&#x27;s firstBlockIndex is not important in a GCI file.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="wii">Wii<a class="hash-link" href="#wii" title="Direct link to heading">​</a></h3><ul><li>TBD</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="nvidia-shield">Nvidia Shield<a class="hash-link" href="#nvidia-shield" title="Direct link to heading">​</a></h3><p>The Shield&#x27;s save data is 0x4000 bytes long. It is composed of Blocks 3 and 4, which are the Quest Log data block and its backup.</p><ul><li>The Header blocks are not important since their only purpose is to provide banner, icon, and comments data to the Gamecube IPL.</li><li>The DirectoryEntry is not important since it only provides metadata about the Header blocks and other values which are specific to the memory card (such as firstBlockIndex).</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="closing-thoughts">Closing Thoughts<a class="hash-link" href="#closing-thoughts" title="Direct link to heading">​</a></h2><p>Here we only covered as much as was necessary to talk about the memory card in the context of TP. If you would like to read more about the structure of data on the memory card, check out these links:</p><ul><li><a href="http://hitmen.c02.at/files/yagcd/yagcd/chap12.html" target="_blank" rel="noopener noreferrer">Yet Another Gamecube Documentation (YAGCD) Ch. 12</a></li><li><a href="https://github.com/dolphin-emu/dolphin/blob/5513d5f4f732fb1e436765ab87e7d60ba02b1ad6/Source/Core/Core/HW/GCMemcard/GCMemcard.h" target="_blank" rel="noopener noreferrer">GCMemcard.h in Dolphin</a></li><li><a href="https://github.com/devkitPro/libogc/blob/master/gc/ogc/card.h" target="_blank" rel="noopener noreferrer">libogc/card.h</a></li></ul><p>Note that YAGCD is wrong about <code>imageFlags</code> in the DirectoryEntry, so be sure to check the Dolphin source code for that one.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-5-identical-icons">Why 5 identical icons?<a class="hash-link" href="#why-5-identical-icons" title="Direct link to heading">​</a></h3><p>You might have noticed that 87% of block 2 is unused and that we could easily fit the Header on a single block if we did not store 5 copies of the same icon pixel data.</p><p>In short, the Header could have been a single block making the game 3 total blocks instead of 4. An animated icon was probably planned at some point but never came to fruition. Below is the detailed explanation.</p><p>Icon metadata for some games which do not have an animated icon:</p><table><thead><tr><th>Game</th><th>iconFormats</th><th>iconAnimationSpeeds</th><th>iconAnimPattern bit</th></tr></thead><tbody><tr><td>Metroid Prime</td><td>0x0001</td><td>0x0002</td><td>0</td></tr><tr><td>Resident Evil 0</td><td>0x0002</td><td>0x0002</td><td>0</td></tr><tr><td>Resident Evil 4</td><td>0x0001</td><td>0x0003</td><td>1</td></tr><tr><td>Super Smash Bros. Melee</td><td>0x0001</td><td>0x0003</td><td>0</td></tr><tr><td>Tales of Symphonia</td><td>0x0002</td><td>0x0003</td><td>0</td></tr><tr><td>The Legend of Zelda: Four Swords Adventures</td><td>0x0001</td><td>0x0003</td><td>0</td></tr><tr><td>The Legend of Zelda: The Wind Waker</td><td>0x0001</td><td>0x0003</td><td>0</td></tr></tbody></table><p>All of these games indicate that they have a single icon in the <code>iconFormats</code> field.</p><p>Icon metadata for some games with an animated icon:</p><table><thead><tr><th>Game</th><th>iconFormats</th><th>iconAnimationSpeeds</th><th>iconAnimPattern bit</th></tr></thead><tbody><tr><td>Fire Emblem: Path of Radiance</td><td>0x0015</td><td>0x003b</td><td>1</td></tr><tr><td>Kirby Air Ride</td><td>0x5555</td><td>0xef55</td><td>0</td></tr><tr><td>Luigi&#x27;s Mansion</td><td>0x4041</td><td>0xffff</td><td>1</td></tr><tr><td>Mario Kart: Double Dash!!</td><td>0x0015</td><td>0x002a</td><td>0</td></tr><tr><td>Sonic Adventure 2 Battle</td><td>0x000a</td><td>0x000f</td><td>1</td></tr><tr><td>Soulcalibur II</td><td>0x5555</td><td>0xaaaf</td><td>1</td></tr><tr><td>Super Mario Sunshine</td><td>0x0005</td><td>0x000f</td><td>0</td></tr><tr><td>The Legend of Zelda: Ocarina of Time Master Quest</td><td>0x002a</td><td>0x002a</td><td>1</td></tr><tr><td>The Legend of Zelda: Twilight Princess</td><td>0x0155</td><td>0x0155</td><td>1</td></tr></tbody></table><p>These games which have animated icons indicate multiple icons in their <code>iconFormats</code> field. It it clear that Twilight Princess&#x27;s icon metadata (bottom row of table) matches the pattern of the animated icons.</p><p>Another other important thing to note is that The Wind Waker only has a single icon, and its metadata lines up with what you would expect (see the bottom row of the first table). It would not make sense for the developers to take something which was already working and make it worse for no reason.</p><p>Additionally, an animated icon is the only valid use case for storing multiple icons in a file on the memory card.</p><p>For these reasons, I think it is pretty evident that the developers had plans for an animated icon. I suspect that they either ran out of time or decided against it, and they never went back to update the code. Either way, what we end up with is a game with save data which takes 4 blocks when it could have easily taken 3.</p><p>Below is a modified memory card which contains TP data which has been adjusted to take only 3 blocks. You can download it and view it in a Gamecube IPL or Dolphin&#x27;s Memory Card Manager to see that it only uses 3 blocks yet provides the same icon, banner, and comments metadata. If you inspect it in a hex editor, you will see that it contains the 2 Quest Log blocks as well.</p><p><a target="_blank" href="/tp-docs/saveData/raw/mem59_tp3Blocks.USA.raw">Download mem59_tp3Blocks.USA.raw</a></p><p>Note that the data will not work with the Twilight Princess game since TP expects its save data to be 4 blocks, and it verifies that the metadata (DirectoryEntry) matches certain values. The above file is just to demonstrate that the Header blocks (which exist purely for the IPL&#x27;s sake) could have been a single block and been functionally indistinguishable from the normal 2 block header.</p><p>For your convenience, below is an image of what this would look like. The image is taken from a Gamecube IPL running in Dolphin.</p><img loading="lazy" src="/tp-docs/assets/images/gcIplTp3Blocks-02962eb35d533393ea987bc7f9b4aa40.png" alt="zelda2_gc_banner.bti" class="img_ev3q"><h3 class="anchor anchorWithStickyNavbar_LWe7" id="default-selection-on-the-file-select-screen">Default selection on the file select screen?<a class="hash-link" href="#default-selection-on-the-file-select-screen" title="Direct link to heading">​</a></h3><p>You might expect there to be some metadata outside of the quest log data which indicates the quest log to default to on the file select screen, but this is not the case.</p><p>The default is picked this way:</p><ul><li>From the set which includes Quest Log 1 and any other Quest Logs which pass their checksum test, pick the Quest Log which has the latest timestamp (compared at the seconds level).</li><li>In the case of a tie, Quest Log 1 has the highest priority and Quest Log 3 has the lowest priority.</li></ul><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>Quest Logs which fail their checksum test say &quot;This Quest Log is corrupted.&quot;</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="naming">Naming<a class="hash-link" href="#naming" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="general">General<a class="hash-link" href="#general" title="Direct link to heading">​</a></h3><p>Names on this page were decided in this way:</p><ol><li>Pick the best name from a group of memory card references.</li><li>Make adjustments with clarity, accuracy, and styling in mind.</li></ol><p>Some examples:</p><ul><li>publisherCode is called makercode in some of the references, but it was changed here since publisher is more accurate. Using an example from YAGCD, Retro Studios developed Metroid Prime, but the publisherCode is still &quot;01&quot; for Nintendo.</li><li>&quot;animation speed&quot; was changed to &quot;iconAnimationSpeeds&quot; so you can quickly tell that it relates to icons and that the field stores multiple speeds.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="directoryentry-2">DirectoryEntry<a class="hash-link" href="#directoryentry-2" title="Direct link to heading">​</a></h3><p>This DirectoryEntry data is written as an entry on the Directory Block, hence the name DirectoryEntry.
We are using this name for a couple of reasons:</p><ul><li>Variations of &quot;directory entry&quot; (such as &#x27;DEntry&#x27; and &#x27;<!-- -->_<!-- -->card_direntry&#x27;) are what you will see in other places.</li><li>We can afford to be more descriptive with the name since this is only documentation and not source code.</li></ul><p>The OS functions <code>CARDGetStatus</code> and <code>CARDSetStatus</code> handle reading and writing data to the DirectoryEntry through a similar object structure which might have been called <code>CARDStat</code>. libogc calls the structure <code>_card_stat</code>, and <code>frameworkF.map</code> mentions these functions as coming from <code>CARDStat.o</code>.</p><p>TP also has funtions <code>m_Do_MemCardRWmng::mDoMemCdRWm_SetCardStat</code> and <code>m_Do_MemCardRWmng::mDoMemCdRWm_CheckCardStat</code> which call the OS functions internally.</p><p>These function names bring to mind the Linux command <code>stat</code> which is said to &quot;display file or file system status&quot;. The data in this 0x40 byte chunk is essentially what you would see if you could run that command on a memory card (metadata about a file stored in the filesystem).</p><p>The term &quot;Directory Block&quot; is supported by the OS function <code>card::__CARDGetDirBlock</code>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="references">References<a class="hash-link" href="#references" title="Direct link to heading">​</a></h2><ul><li><a href="http://hitmen.c02.at/files/yagcd/yagcd/chap12.html" target="_blank" rel="noopener noreferrer">Yet Another Gamecube Documentation (YAGCD) Ch. 12</a></li><li><a href="https://github.com/dolphin-emu/dolphin/blob/5513d5f4f732fb1e436765ab87e7d60ba02b1ad6/Source/Core/Core/HW/GCMemcard/GCMemcard.h" target="_blank" rel="noopener noreferrer">GCMemcard.h in Dolphin</a></li><li><a href="https://github.com/devkitPro/libogc/blob/master/gc/ogc/card.h" target="_blank" rel="noopener noreferrer">libogc/card.h</a></li><li><a href="https://wiki.dolphin-emu.org/index.php?title=GameIDs" target="_blank" rel="noopener noreferrer">GameIDs - Dolphin Emulator Wiki</a></li><li><a href="https://github.com/suloku/gcmm/blob/master/source/gci.h" target="_blank" rel="noopener noreferrer">gci.h in gcmm</a></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/icogn/tp-docs/edit/main/website/docs/save-file/memory-card.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/tp-docs/docs/save-file/save-file-introduction"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Save File Introduction</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/tp-docs/docs/save-file/quest-log/introduction"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Introduction</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a><ul><li><a href="#blocks" class="table-of-contents__link toc-highlight">Blocks</a></li><li><a href="#directoryentry" class="table-of-contents__link toc-highlight">DirectoryEntry</a></li><li><a href="#twilight-princess-save-data" class="table-of-contents__link toc-highlight">Twilight Princess Save Data</a></li></ul></li><li><a href="#blocks-1" class="table-of-contents__link toc-highlight">Blocks</a><ul><li><a href="#header-blocks" class="table-of-contents__link toc-highlight">Header Blocks</a></li><li><a href="#quest-log-blocks" class="table-of-contents__link toc-highlight">Quest Log Blocks</a></li></ul></li><li><a href="#directoryentry-1" class="table-of-contents__link toc-highlight">DirectoryEntry</a><ul><li><a href="#gamecode" class="table-of-contents__link toc-highlight">gameCode</a></li><li><a href="#publishercode" class="table-of-contents__link toc-highlight">publisherCode</a></li><li><a href="#padding_06" class="table-of-contents__link toc-highlight">padding_06</a></li><li><a href="#imageflags" class="table-of-contents__link toc-highlight">imageFlags</a></li><li><a href="#filename" class="table-of-contents__link toc-highlight">filename</a></li><li><a href="#lastmodified" class="table-of-contents__link toc-highlight">lastModified</a></li><li><a href="#imagedataoffset" class="table-of-contents__link toc-highlight">imageDataOffset</a></li><li><a href="#iconformats" class="table-of-contents__link toc-highlight">iconFormats</a></li><li><a href="#iconanimationspeeds" class="table-of-contents__link toc-highlight">iconAnimationSpeeds</a></li><li><a href="#permissions" class="table-of-contents__link toc-highlight">permissions</a></li><li><a href="#copycounter" class="table-of-contents__link toc-highlight">copyCounter</a></li><li><a href="#firstblockindex" class="table-of-contents__link toc-highlight">firstBlockIndex</a></li><li><a href="#numblocks" class="table-of-contents__link toc-highlight">numBlocks</a></li><li><a href="#padding_38" class="table-of-contents__link toc-highlight">padding_38</a></li><li><a href="#commentsoffset" class="table-of-contents__link toc-highlight">commentsOffset</a></li></ul></li><li><a href="#directoryentry-follow-up" class="table-of-contents__link toc-highlight">DirectoryEntry Follow-up</a><ul><li><a href="#why-0xff" class="table-of-contents__link toc-highlight">Why is the padding 0xff?</a></li><li><a href="#thoughts-on-lastmodified" class="table-of-contents__link toc-highlight">Thoughts on lastModified</a></li><li><a href="#checkcardstat" class="table-of-contents__link toc-highlight">CheckCardStat</a></li><li><a href="#room-for-custom-data" class="table-of-contents__link toc-highlight">Room for custom data?</a></li></ul></li><li><a href="#other-formats" class="table-of-contents__link toc-highlight">Other Formats</a><ul><li><a href="#gcis" class="table-of-contents__link toc-highlight">GCIs</a></li><li><a href="#wii" class="table-of-contents__link toc-highlight">Wii</a></li><li><a href="#nvidia-shield" class="table-of-contents__link toc-highlight">Nvidia Shield</a></li></ul></li><li><a href="#closing-thoughts" class="table-of-contents__link toc-highlight">Closing Thoughts</a><ul><li><a href="#why-5-identical-icons" class="table-of-contents__link toc-highlight">Why 5 identical icons?</a></li><li><a href="#default-selection-on-the-file-select-screen" class="table-of-contents__link toc-highlight">Default selection on the file select screen?</a></li></ul></li><li><a href="#naming" class="table-of-contents__link toc-highlight">Naming</a><ul><li><a href="#general" class="table-of-contents__link toc-highlight">General</a></li><li><a href="#directoryentry-2" class="table-of-contents__link toc-highlight">DirectoryEntry</a></li></ul></li><li><a href="#references" class="table-of-contents__link toc-highlight">References</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 icogn</div></div></div></footer></div>
<script src="/tp-docs/assets/js/runtime~main.adbb371e.js"></script>
<script src="/tp-docs/assets/js/main.789a4f82.js"></script>
</body>
</html>