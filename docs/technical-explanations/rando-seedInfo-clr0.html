<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-technical-explanations/rando-seedInfo-clr0">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Rando SeedInfo CLR0 Structure | TP Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://icogn.github.io/tp-docs/docs/technical-explanations/rando-seedInfo-clr0"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Rando SeedInfo CLR0 Structure | TP Docs"><meta data-rh="true" name="description" content="This page describes a way of storing RGB colors in the TPRando seed GCI."><meta data-rh="true" property="og:description" content="This page describes a way of storing RGB colors in the TPRando seed GCI."><link data-rh="true" rel="icon" href="/tp-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://icogn.github.io/tp-docs/docs/technical-explanations/rando-seedInfo-clr0"><link data-rh="true" rel="alternate" href="https://icogn.github.io/tp-docs/docs/technical-explanations/rando-seedInfo-clr0" hreflang="en"><link data-rh="true" rel="alternate" href="https://icogn.github.io/tp-docs/docs/technical-explanations/rando-seedInfo-clr0" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/tp-docs/blog/rss.xml" title="TP Docs RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/tp-docs/blog/atom.xml" title="TP Docs Atom Feed"><link rel="stylesheet" href="/tp-docs/assets/css/styles.7afa8f30.css">
<link rel="preload" href="/tp-docs/assets/js/runtime~main.adbb371e.js" as="script">
<link rel="preload" href="/tp-docs/assets/js/main.789a4f82.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/tp-docs/"><div class="navbar__logo"><img src="/tp-docs/img/logo.svg" alt="TP Docs Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/tp-docs/img/logo.svg" alt="TP Docs Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">TP Docs</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/icogn/tp-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/tp-docs/docs/technical-explanations/ostickstocalendartime">OSTicksToCalendarTime</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/tp-docs/docs/technical-explanations/rando-seed-file-thoughts">Rando Seed File Thoughts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/tp-docs/docs/technical-explanations/rando-seed-versioning">Rando Seed Versioning</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/tp-docs/docs/technical-explanations/rando-seedInfo-arcp-proposal">Rando SeedInfo ARCP Structure Proposal</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/tp-docs/docs/technical-explanations/rando-seedInfo-clr0">Rando SeedInfo CLR0 Structure</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/tp-docs/docs/technical-explanations/sprlocksoftlock">Snowpeak Ruins Lock Softlock</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/tp-docs/docs/technical-explanations/texture-recoloring">Texture Recoloring</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/tp-docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Rando SeedInfo CLR0 Structure</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Rando SeedInfo CLR0 Structure</h1><p>This page describes a way of storing RGB colors in the TPRando seed GCI.
The main purpose of these colors would be for recoloring things in the game (such as tunic color).</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="intro">Intro<a class="hash-link" href="#intro" title="Direct link to heading">​</a></h2><p>The simplistic approach to storing these colors would be to have an array of 4-byte structures as follows:</p><table><thead><tr><th>Offset</th><th>Type</th><th>Name</th></tr></thead><tbody><tr><td>0x00</td><td>u8</td><td>isEnabled</td></tr><tr><td>0x01</td><td>u8<!-- -->[3]</td><td>RGB</td></tr></tbody></table><p>Each thing you want to recolor would be represented by an enum such as:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Tunic: 0,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ZoraArmorPrimary: 1,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ZoraArmorSecondary: 2,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ZoraArmorHelmet: 3,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    OrdonShield: 4,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You would then have an array of the 4-byte structures such that the index in the array is the enum.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Example byte array</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    TunicEnabled,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    TunicR,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    TunicG,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    TunicB,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ZoraArmorPrimaryEnabled,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ZoraArmorPrimaryR,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ZoraArmorPrimaryG,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ZoraArmorPrimaryB,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>ZoraArmorPrimary</code> has a value of 1, so we would look at offset 1 in the array (starts at byte 0x04 since each structure is 4 bytes).</p><p>With this approach, the size of the CLR0 structure would be 4 bytes <!-- -->*<!-- --> numberOfSupportedEnums.</p><p>In order to future-proof and in order to simultaneously support a more space-efficient design, we will want a header.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="header">Header<a class="hash-link" href="#header" title="Direct link to heading">​</a></h2><p>This chunk in the seed data is named CLR0.</p><p><code>CLR</code> is short for &quot;color&quot;, and the 0 is essentially the version number.</p><p>This follows the scheme that is used by pretty much every file in the game (that is, sections start with a 4-char label).</p><hr><p>Adding to the example from before, the byte array would look like:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Example byte array</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;C&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;L&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;R&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;0&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    HeaderOffset_0x04,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    HeaderOffset_0x05,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    HeaderOffset_0x06,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    HeaderOffset_0x07,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    HeaderOffset_0x08,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    HeaderOffset_0x09,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    HeaderOffset_0x0a,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    HeaderOffset_0x0b,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    HeaderOffset_0x0c,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    HeaderOffset_0x0d,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    HeaderOffset_0x0e,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    HeaderOffset_0x0f,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    TunicEnabled,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    TunicR,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    TunicG,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    TunicB,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ZoraArmorPrimaryEnabled,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ZoraArmorPrimaryR,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ZoraArmorPrimaryG,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ZoraArmorPrimaryB,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="space-efficient-approach">Space-efficient approach<a class="hash-link" href="#space-efficient-approach" title="Direct link to heading">​</a></h2><p>The above works well if you only need to store a few colors.
But what if we need to be able to store 75 colors?</p><p>This is not that farfetched when you consider that the Midna color customizations contain 7 distinct RGB values, and the Zora Armor contains 3.</p><p>Also consider the case in which we support 75 recoloring options, but the player decided the only thing they want to recolor is the tunic (which takes 1 RGB value).
With the simplistic approach, we would have approximately 74 <!-- -->*<!-- --> 4 bytes of wasted data (296 or 0x128 bytes which is nearly 4% of a block).</p><hr><p>Instead of including an array entry for every single enum, we would ideally only include entries for enums we are actually using.
Then if the player only needed 2 colors, we would only need 6 bytes of RGB data instead of 3 <!-- -->*<!-- --> 75 bytes.</p><p>The problem then becomes how do we map an enum to its index in the RGB array (previously the enum and its index were always identical).</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="mapping-enum-to-rgb-index">Mapping enum to rgb index<a class="hash-link" href="#mapping-enum-to-rgb-index" title="Direct link to heading">​</a></h2><p>Imagine we have a bunch of enums which are either enabled or disabled.</p><table><thead><tr><th>Enum</th><th>Enabled?</th></tr></thead><tbody><tr><td>0x0000</td><td>enabled</td></tr><tr><td>0x0001</td><td>no</td></tr><tr><td>0x0002</td><td>no</td></tr><tr><td>0x0003</td><td>enabled</td></tr><tr><td>0x0004</td><td>no</td></tr><tr><td>0x0005</td><td>enabled</td></tr><tr><td>0x0006</td><td>enabled</td></tr><tr><td>0x0007</td><td>no</td></tr><tr><td>0x0008</td><td>enabled</td></tr><tr><td>0x0009</td><td>no</td></tr><tr><td>0x000a</td><td>enabled</td></tr><tr><td>0x000b</td><td>no</td></tr></tbody></table><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>The enums are u16 (not u8) so that we are not limited to 256 colors.
We might never hit that limit, but it is not so unlikely that we shouldn&#x27;t plan for it.</p></div></div><p>The RGB array for this would look like:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Example byte array</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    enum_0000_R, enum_0000_G, enum_0000_B, // offset 0x0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    enum_0003_R, enum_0003_G, enum_0003_B, // offset 0x3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    enum_0005_R, enum_0005_G, enum_0005_B, // offset 0x6</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    enum_0006_R, enum_0006_G, enum_0006_B, // offset 0x9</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    enum_0008_R, enum_0008_G, enum_0008_B, // offset 0xc</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    enum_000a_R, enum_000a_G, enum_000a_B, // offset 0xf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>There are 2 things we need to be able to do given an enum:</p><ul><li>Determine if it is enabled or not.</li><li>Find its index in the RGB data.</li></ul><hr><p>For example, using the above data, we want to find the RGB index of enum 0x8.</p><p>(Let&#x27;s assume we magically know that enum 0x8 is enabled for the time being)</p><p>The solution is to count up how many of the enums 0 through 7 are enabled.</p><p>Since enums 0, 3, 5, and 6 are enabled (4 total), enum 8&#x27;s RGB index is 4.</p><p>However, this way of determining the memory index is too slow and does not scale well.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="check-enum-is-enabled">Check enum is enabled<a class="hash-link" href="#check-enum-is-enabled" title="Direct link to heading">​</a></h2><p>Let&#x27;s go ahead and answer the question of how we can tell that an enum is enabled.</p><p>There is no reason to waste more than a single bit on this, so we only need one byte for every 8 enums (rounded up).</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// pseudocode</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">function isThisEnumEnabled(u16 myEnum) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    u16 tableIndex = myEnum &gt;&gt; 3;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    u8 bitMask = 1 &lt;&lt; (myEnum &amp; 0x7);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Assume we have a reference to the bitTable in the CLR0 chunk.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return (bitTable[tableIndex] &amp; bitMask) !== 0;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>The above is slightly different than how it actually works in code
We have to adjust the input based on the minRecolorId in the header.
Always reference the code if you want to see exactly how something works.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="mapping-enum-to-rgb-index-quickly">Mapping enum to rgb index quickly<a class="hash-link" href="#mapping-enum-to-rgb-index-quickly" title="Direct link to heading">​</a></h2><p>If we are looking up enum 0x3e (62 decimal), instead of iterating through enums 0 through 0x3d and keeping track of how many are enabled, we can instead keep track of the cummulative results for every 8 enums.</p><p>For example:</p><table><thead><tr><th>cummulativeSums Index</th><th>For Enums X to Y</th><th>Cummulative Count</th></tr></thead><tbody><tr><td>0x00</td><td>0x0000 to 0x0007</td><td>0x0000</td></tr><tr><td>0x01</td><td>0x0008 to 0x000f</td><td>0x0003</td></tr><tr><td>0x02</td><td>0x0010 to 0x0017</td><td>0x0005</td></tr><tr><td>0x03</td><td>0x0018 to 0x001f</td><td>0x0005</td></tr><tr><td>0x04</td><td>0x0020 to 0x0027</td><td>0x0008</td></tr><tr><td>0x05</td><td>0x0028 to 0x002f</td><td>0x000c</td></tr><tr><td>0x06</td><td>0x0030 to 0x0037</td><td>0x0010</td></tr><tr><td>0x07</td><td>0x0038 to 0x003f</td><td>0x0012</td></tr></tbody></table><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>The cummulative sum for index 0 will always be 0, so we will leave this off in the final structure.</p></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">enumNumber &gt;&gt; 3.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>0x3e &gt;&gt; 3 gives 7.</p><p>We check the cummulative value at index 7.
The value for this is 0x12.</p><p>So then we fetch the value from the bitTable at offset 7.<br>
Let&#x27;s assume it like the following bits:</p><p>0101 0110</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>From left to right, these bits are for enums 0x3f, 0x3e, 0x3d, 0x3c, 0x3b, 0x3a, 0x39, and 0x38.</p></div></div><p>So now all we need to do is count the number of set bits to the right of our bit in question (which is bit 6 in this case), then add this value to the cummulative value (which we determined was 0x12).</p><p>The number of set bits to the right of bit 6 is 3, so our RGB index for enum 0x3f is 0x15 (0x12 + 3).</p><hr><p>So the final question to answer is how do we quickly count the number of bits to the right of bit 6.</p><p>Fortunately, this is a solved problem.</p><p>We can keep a small lookup table to quickly map from a bit pattern to the number of bits which are set.</p><p>For 8 bits, there are 256 possible patterns.
If we instead process each half of the 8 bits individually and add the results, we only need to handle 16 patterns:</p><table><thead><tr><th>bit pattern</th><th>num bits set</th></tr></thead><tbody><tr><td>0b0000</td><td>0</td></tr><tr><td>0b0001</td><td>1</td></tr><tr><td>0b0010</td><td>1</td></tr><tr><td>0b0011</td><td>2</td></tr><tr><td>0b0100</td><td>1</td></tr><tr><td>0b0101</td><td>2</td></tr><tr><td>0b0110</td><td>2</td></tr><tr><td>0b0111</td><td>3</td></tr><tr><td>0b1000</td><td>1</td></tr><tr><td>0b1001</td><td>2</td></tr><tr><td>0b1010</td><td>2</td></tr><tr><td>0b1011</td><td>3</td></tr><tr><td>0b1100</td><td>2</td></tr><tr><td>0b1101</td><td>3</td></tr><tr><td>0b1110</td><td>3</td></tr><tr><td>0b1111</td><td>4</td></tr></tbody></table><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// pseudocode, from https://stackoverflow.com/questions/9949935/calculate-number-of-bits-set-in-byte</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">uint8_t NIBBLE_LOOKUP [16] =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    0, 1, 1, 2, 1, 2, 2, 3,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    1, 2, 2, 3, 2, 3, 3, 4</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">};</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">uint8_t count_ones (uint8_t byte)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return NIBBLE_LOOKUP[byte &amp; 0x0F] + NIBBLE_LOOKUP[byte &gt;&gt; 4];</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The above will return the total number of set bits in a byte, but we are only concerned with the bits to the right of a specific one, so we can adjust it to the following:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// pseudocode</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">uint8_t NIBBLE_LOOKUP [16] =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    0, 1, 1, 2, 1, 2, 2, 3,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    1, 2, 2, 3, 2, 3, 3, 4</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">};</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">uint8_t BITS_TO_RIGHT_MASK [8] =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    0x00, 0x01, 0x03, 0x07, 0x0f, 0x1f, 0x3f, 0x7f</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">};</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// bitIndex is one of 0,1,2,3,4,5,6,7. 0 means the least significant bit.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Given a bit index, returns the number of bits which have a lower index and are set.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">int8_t countSetBitsToRight( uint8_t byte, uint8_t bitIndex )</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if ( bitIndex == 0 )</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return 0;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    uint8_t maskedByte = byte &amp; BITS_TO_RIGHT_MASK[bitIndex];</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    uint8_t result = NIBBLE_LOOKUP[maskedByte &amp; 0x0f];</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if ( bitIndex &gt;= 5 )</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        result += NIBBLE_LOOKUP[maskedByte &gt;&gt; 4];</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return result;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>So we now have all of the tools we need.</p><p>Let&#x27;s talk about the entire CLR0 structure now.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="clr0-structure">CLR0 structure<a class="hash-link" href="#clr0-structure" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="header-1">Header<a class="hash-link" href="#header-1" title="Direct link to heading">​</a></h3><p>Header is size 0x16 bytes.</p><table><thead><tr><th>Offset</th><th>Type</th><th>Name</th><th>Description</th></tr></thead><tbody><tr><td>0x00</td><td>char<!-- -->[4]</td><td>magic</td><td>&quot;CLR0&quot;</td></tr><tr><td>0x04</td><td>u32</td><td>totalByteSize</td><td>Total number of bytes for chunk (including header and padding at end).</td></tr><tr><td>0x08</td><td>u8</td><td>reserved</td><td>Not currently used. Always 0x00.</td></tr><tr><td>0x09</td><td>u8</td><td>bitTableOffset</td><td>Offset to bitTable section relative to start of header.</td></tr><tr><td>0x0a</td><td>u16</td><td>minRecolorId</td><td>Must be equal to the smallest enum which has data.</td></tr><tr><td>0x0c</td><td>u16</td><td>maxRecolorId</td><td>Must be equal to the largest enum which has data.</td></tr><tr><td>0x0e</td><td>u16</td><td>cummulativeSumsOffset</td><td>Offset to cummulativeSums section relative to start of header.</td></tr><tr><td>0x10</td><td>u32</td><td>complexDataOffset</td><td>Offset to complexData section relative to start of header.</td></tr><tr><td>0x14</td><td>u16</td><td>basicDataOffset</td><td>Offset to basicData section relative to start of header.</td></tr></tbody></table><p>Note that the sections of the CLR0 chunk are ordered as follows:</p><ul><li>header</li><li>bitTable</li><li>cummulativeSums</li><li>basicData</li><li>complexData</li></ul><p>Notes on certain header properties:</p><ul><li>magic<ul><li>CLR0 could change to CLR1 and so on if we ever needed an entire restructure of this chunk for some reason (though that doesn&#x27;t seem likely).</li></ul></li><li>maxEnum<ul><li>This is used to future-proof.
Let&#x27;s assume at the current day we are using enums 0x0000 through 0x00ab.
If someone generates a seed today, its bitTable and cummulativeSums will be a certain size.
If someone then uses that seed with the newer randomizer 6 months later, that rando code might try to check &quot;should I recolor enum 0xcc?&quot;
If we didn&#x27;t have a bounds on the maximum we should check, we would start reading bytes from outside the table and misinterpreting them.<ul><li>Note that this value should be the largest enum which the player actually elected to recolor, not the largest one that could have been supported at the time the seed was generated.
The lower we can make this value, the smaller we can make both the bitTable and cummulativeSums sections.<ul><li>bitTable byte length should be ((maxEnum &gt;&gt; 3) + 1) rounded up to multiple of 2.</li><li>cummulativeSums section byte length should be (bitTable length - 1) <!-- -->*<!-- --> 2.</li></ul></li></ul></li></ul></li><li>bitTableOffset<ul><li>The header is only 0x16 bytes long, so we don&#x27;t need more than a byte for bitTableOffset.</li><li>This value must be set to 0 if there is no data for any enums (meaning the CLR0 chunk is empty).</li></ul></li><li>cummulativeSumsOffset
The max enum is 0xffff.
(0xffff &gt;&gt; 3) is 0x1fff which is the maximum index of the bitTable.
So the max bitTable length is one more than that, or 0x2000.
Adding the 0x16 from the bitTableOffset, the largest value we could have for this is 0x2016, so u16 is enough for this field.</li><li>basicData<ul><li>The max enum is 0xffff.
(0xffff &gt;&gt; 3) is 0x1fff which is the maximum index of the cummulativeSums section.
So the max cummulativeSums length is one more than that, or 0x2000.
Since each entry is a u16 (2 bytes), the maximum byte length of the cummulativeSums section is 0x4000.
Adding this to the maximum cummulativeSumsOffset which is 0x2016, the maximum possible basicDataOffset value is 0x6016.
So a u16 is enough for basicData.</li><li>Note that the basicData should immediately follow the cummulativeSums section.</li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="bittable">bitTable<a class="hash-link" href="#bittable" title="Direct link to heading">​</a></h3><p>bitTable section is an array of bytes which comes directly after the header.</p><p>It contains one byte for every 8 recolorIds.</p><p>If no recolorIds are enabled, the offset to the bitTable in the header must be 0.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cummulativesums">cummulativeSums<a class="hash-link" href="#cummulativesums" title="Direct link to heading">​</a></h3><p>cummulativeSums section is an array of u16 which comes directly after the bitTable section.
We leave off the entry for index 0 of the bitTable since it would always be 0x0000.</p><p>If this section is empty, the offset to it in the header should be 0.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="basicdata">basicData<a class="hash-link" href="#basicdata" title="Direct link to heading">​</a></h3><p>The basicData section comes directly after the cummulativeSums section, and it is an array of words.</p><p>For example, an entry might be:</p><p><code>00 63 82 A0</code></p><p>The first byte is an enum called the <code>RecolorType</code>.</p><p>In this case, 0x00 means the next 3 bytes (63 82 A0) are an rgb value (63 is R, 82 is G ,and A0 is B).</p><p>The last 3 bytes could have a different meaning depending on the first byte (the enum).
For example, if the first byte was 0x01 meaning RgbArray, then the remaining 3 bytes would actually be an offset in the complexData section, and the RGB array would be stored in the complexData section.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="complexdata">complexData<a class="hash-link" href="#complexdata" title="Direct link to heading">​</a></h3><p>The complexData section could very well be empty (in which case the offset to it in the header should be 0).</p><p>But assuming it is not empty, it is just an array of bytes with no structure.</p><p>A basicData entry which makes use of it will point to an offset in the complexData section.
The bytes at that location in the complexData will be interpreted according to the enum that was in the basicData.</p><p>For example, recolorType 0x01 is an RgbArray.</p><p>Let&#x27;s look at some example data:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">43 4C 52 30 00 00 00 38 00 16 00 00 00 07 00 00  CLR0...8........</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">00 00 00 1F 00 17 81 00 63 82 A0 01 00 00 00 08  ........c, .....</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">FF FF FF FF A0 FF FF FF 40 00 E8 7B 00 F3 FF 00  .... ...@..{....</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">AA FF 60 78 FF 00 00 00 00 00 00 00 00 00 00 00  ..`x............</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>From offset 0x14 of the header, we get that the basicData offset is 0x0017.</p><p>The 2 basicData entries are as follows:</p><ul><li>00 63 82 A0</li><li>01 00 00 00</li></ul><p>Looking at the 2nd entry, we see the RecolorType is 0x01 which is RgbArray.
This means the last 3 bytes (in this case, 00 00 00) is an offset in the complexData section.</p><p>We can get the offset to the complexData section from offset 0x10 of the header.</p><p>In this case, the complexData section is at offset 0x1F.</p><p>So the data we are looking at starts with <code>08 FF FF FF FF A0 ...</code>.</p><p>The structure of the data is entirely dependent on the recolorType, but in the case of RgbArray, the first byte is the array length, and it is followed by 3 byte RGB array entries.</p><p>So in this case:</p><ul><li>length<ul><li>8</li></ul></li><li>entries:<ul><li>FF FF FF</li><li>FF A0 FF</li><li>FF FF 40</li><li>00 E8 7B</li><li>00 F3 FF</li><li>00 AA FF</li><li>60 78 FF</li><li>00 00 00</li></ul></li></ul><p>The above data in this example are the colors for the rainbow hearts.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>The rainbow hearts are always displayed in the game with an ABCABCABC pattern.
If you wanted a ping-pong ABCBABCBA pattern, you could probably update the first byte to be:
0x80 mask gives 0 or 1 to indicate pattern, and the 0x7F mask gives the array length.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="other-notes">Other notes<a class="hash-link" href="#other-notes" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="future-splitting-up-of-recoloring">Future splitting up of recoloring<a class="hash-link" href="#future-splitting-up-of-recoloring" title="Direct link to heading">​</a></h3><p>Let&#x27;s assume that the tunic recoloring is enum 0x0000.</p><p>It is possible that in the future, we will want people to be able to recolor the hat and body separately.</p><p>In that case, we can add 2 new enums (let&#x27;s say 0x00cd and 0x00ce).</p><p>Then in the rando code, we can check if either of these is enabled.<br>
If either is enabled, we will use the values from those enums and ignore enum 0x0000.</p><p>We still want to support 0x0000 for backwards compatibility if neither of the new enums are enabled but 0x0000 is enabled.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/icogn/tp-docs/edit/main/website/docs/technical-explanations/rando-seedInfo-clr0.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/tp-docs/docs/technical-explanations/rando-seedInfo-arcp-proposal"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Rando SeedInfo ARCP Structure Proposal</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/tp-docs/docs/technical-explanations/sprlocksoftlock"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Snowpeak Ruins Lock Softlock</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#intro" class="table-of-contents__link toc-highlight">Intro</a></li><li><a href="#header" class="table-of-contents__link toc-highlight">Header</a></li><li><a href="#space-efficient-approach" class="table-of-contents__link toc-highlight">Space-efficient approach</a></li><li><a href="#mapping-enum-to-rgb-index" class="table-of-contents__link toc-highlight">Mapping enum to rgb index</a></li><li><a href="#check-enum-is-enabled" class="table-of-contents__link toc-highlight">Check enum is enabled</a></li><li><a href="#mapping-enum-to-rgb-index-quickly" class="table-of-contents__link toc-highlight">Mapping enum to rgb index quickly</a></li><li><a href="#clr0-structure" class="table-of-contents__link toc-highlight">CLR0 structure</a><ul><li><a href="#header-1" class="table-of-contents__link toc-highlight">Header</a></li><li><a href="#bittable" class="table-of-contents__link toc-highlight">bitTable</a></li><li><a href="#cummulativesums" class="table-of-contents__link toc-highlight">cummulativeSums</a></li><li><a href="#basicdata" class="table-of-contents__link toc-highlight">basicData</a></li><li><a href="#complexdata" class="table-of-contents__link toc-highlight">complexData</a></li></ul></li><li><a href="#other-notes" class="table-of-contents__link toc-highlight">Other notes</a><ul><li><a href="#future-splitting-up-of-recoloring" class="table-of-contents__link toc-highlight">Future splitting up of recoloring</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 icogn</div></div></div></footer></div>
<script src="/tp-docs/assets/js/runtime~main.adbb371e.js"></script>
<script src="/tp-docs/assets/js/main.789a4f82.js"></script>
</body>
</html>