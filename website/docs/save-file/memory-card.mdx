# Memory Card

import Link from '@docusaurus/Link';

Here we discuss the Twilight Princess save data structure on the memory card at a high level.
If you are interested in things like rupees and poe souls, please see the <Link to="/docs/save-file/quest-log/introduction">Quest Log</Link>.

## Blocks Overview

Memory card data consists of "blocks" which are each 0x2000 bytes. The first 5 blocks of a memory card are allotted to manage the filesystem.

| Offset | Size   | Description                   |
| ------ | ------ | ----------------------------- |
| 0x0000 | 0x2000 | Header                        |
| 0x2000 | 0x2000 | Directory                     |
| 0x4000 | 0x2000 | Directory (backup)            |
| 0x6000 | 0x2000 | Block Allocation Map          |
| 0x8000 | 0x2000 | Block Allocation Map (backup) |

A game's save data will consist of a certain number of blocks which are located somewhere after the first 5 filesystem blocks.

For example, TP's save data is 4 blocks long, so these blocks might be located at offsets 0xa000, 0xc000, 0xe000, 0x10000 on a fresh memory card, but they could also be at 0x22000, 0x24000, 0x26000, and 0x28000.<br/>
The blocks do not necessarily have to be contiguous, but in practice they usually are, and it may be easier to think of them that way.

:::tip

The official memory card types are Memory Card 59, Memory Card 251, and Memory Card 1019. Do you notice a pattern?<br/>
64 - 5 is 59, 256 - 5 is 251, and 1024 - 5 is 1019.

:::

## DirectoryEntry Overview

The special Directory filesystem block contains an array of Directory Entries which are each 0x40 bytes long.

In addition to its 4 blocks (0x8000 bytes), TP also specifies some `(all?)` of the data which is written to its DirectoryEntry. We will talk more about the DirectoryEntry later after covering the Block data.

## Twilight Princess Save Data Overview

| Size   | Description    |
| ------ | -------------- |
| 0x40   | DirectoryEntry |
| 0x8000 | 4 Blocks       |

You can think above as the above as the TP save data which is on the memory card.

:::tip

A `GCI` file is exactly these two things back to back as shown above.

:::

## Blocks

// Add more here

// References (not finalized):<br/>
// http://hitmen.c02.at/files/yagcd/yagcd/chap12.html<br/>
// https://github.com/dolphin-emu/dolphin/blob/5513d5f4f732fb1e436765ab87e7d60ba02b1ad6/Source/Core/Core/HW/GCMemcard/GCMemcard.h<br/>
// https://github.com/devkitPro/libogc/blob/master/gc/ogc/card.h
