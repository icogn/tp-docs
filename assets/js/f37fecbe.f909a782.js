(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[2317],{229:(e,t,n)=>{"use strict";n.r(t),n.d(t,{contentTitle:()=>p,default:()=>k,frontMatter:()=>h,metadata:()=>m,toc:()=>d});var a=n(7462),i=n(7294),o=n(3905),l=n(9960),r=n(7113),s=(n(2830),n(8764));const u="errorMsg_yXtR",c="File seems quite large. Please open an issue if you need support for an image of this size.";function f(){const[e,t]=(0,i.useState)(""),[n,a]=(0,i.useState)(""),[o,l]=(0,i.useState)("");function f(e){t(""),a(""),l(e)}return i.createElement(i.Fragment,null,i.createElement("form",null,i.createElement("input",{type:"file",accept:"image/png",onChange:function(e){const{files:n}=e.target;if(t(""),a(""),l(""),n.length<1)return;const i=n[0];if(i.size>1e5)return void f(c);const o=new FileReader;o.onload=function(){new r.PNG({filterType:4}).parse(s.Buffer.from(this.result),(function(e,n){if(e)return void f(e.message);if(n.width*n.height>=262144)return void f(c);const o=function(e){let{width:t,height:n,data:a}=e;const i=t+7>>3,o=8*i*(n+3>>2)*4,l=32+o,r=[],s={};for(let d=0;d<o;d++){const e=d>>5,o=e%i*8+d%8,l=4*Math.floor(e/i)+Math.floor(d/8)%4;let u=65535;if(o<t&&l<n){const e=t*l+o<<2,n=a[e],i=a[e+1],r=a[e+2],s=a[e+3];u=255===s?32768|(248&n)<<7|(248&i)<<2|r>>3:(224&s)<<7|(240&n)<<4|240&i|r>>4}if(r[d]=u,s[u]=!0,Object.keys(s).length>256)return"PNG can have at most 256 unique pixel rgba values."}const u=Object.keys(s).sort(((e,t)=>e-t)).map((e=>Number(e))),c=u.reduce((function(e,t,n){return e[t]=n,e}),{}),f=u.length+15&4294967280,h=2*f,p=new ArrayBuffer(l+h),m=new DataView(p);m.setUint8(0,9),m.setUint8(1,2),m.setUint16(2,t),m.setUint16(4,n),m.setUint8(8,1),m.setUint8(9,2),m.setUint16(10,f),m.setUint32(12,l),m.setUint8(20,1),m.setUint8(21,1),m.setUint8(24,1),m.setUint32(28,32);for(let d=0;d<h;d+=4)m.setUint32(d+l,4294967295);for(let d=0;d<u.length;d++)m.setUint16(l+2*d,u[d]);for(let d=0;d<r.length;d++)m.setUint8(32+d,c[r[d]]);return m.buffer}(n);if("string"==typeof o)return void f(o);const r=new Blob([o],{type:"application/octet-stream"});let s;const u=i.name;s=u.endsWith(".png")?u.substring(0,u.length-4)+".bti":u+".bti",t(window.URL.createObjectURL(r)),a(s),l("")}))},o.readAsArrayBuffer(i)}})),!o&&e&&n&&i.createElement("a",{id:"download_link",download:n,href:e},`Download ${n}`),o&&i.createElement("div",{className:u},o),i.createElement("p",null))}const h={},p="PNG to BTI",m={type:"mdx",permalink:"/tp-docs/png-to-ci8",source:"@site/src/pages/png-to-ci8.mdx",title:"PNG to BTI",description:"The goal of this page is to provide a way to create memory efficient icons and banners for GCI files, so it currently only generates BTIs with the following configuration:",frontMatter:{}},d=[{value:"Converter",id:"converter",level:2},{value:"GCI Header",id:"gci-header",level:2}],g={toc:d};function k(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},g,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"png-to-bti"},"PNG to BTI"),(0,o.kt)("p",null,"The goal of this page is to provide a way to create memory efficient icons and banners for GCI files, so it currently only generates BTIs with the following configuration:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Image is CI8 format"),(0,o.kt)("li",{parentName:"ul"},"Palette is RGB5A3 format")),(0,o.kt)("p",null,"There are other tools (such as ",(0,o.kt)(l.Z,{to:"https://szs.wiimm.de/wimgt/",mdxType:"Link"},"wimgt"),") which handle general image conversion, but they do not support BTI files with palettes."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"For a GCI file with a single icon and banner, you waste nearly half a block by not using a palette!")),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},'The image can have a maximum of 0x100 (256 decimal) different pixel colors (rgba values).\nIf your image\'s palette is too large, you can use GIMP to shrink it.\nIn GIMP, select Image > Mode > Indexed.\nUnder "Colormap" in the popup, set the maximum number of colors to 256, then hit "Convert". Now you can export the file as a new PNG which will fit within the palette entry limit.')),(0,o.kt)("hr",null),(0,o.kt)("h2",{id:"converter"},"Converter"),(0,o.kt)("p",null,"Click the button below, then select a PNG file to convert to BTI format."),(0,o.kt)(f,{mdxType:"PngToCi8"}),(0,o.kt)("br",null),(0,o.kt)("hr",null),(0,o.kt)("h2",{id:"gci-header"},"GCI Header"),(0,o.kt)("p",null,"If you use files you generate here in a GCI file, make sure the header has the following values:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Offset 0x07 (imageFlags, u8) - The least significant 2 bits are 0b01. The value will likely be either 0x01 or 0x05."),(0,o.kt)("li",{parentName:"ul"},"Offset 0x30 (iconFormats, u16) - For a single icon, the value here should be 0x0001.")),(0,o.kt)("p",null,"Also, each palette (banner and icon) will have 0x200 bytes reserved for it.\nSo the image data would be one chunk as follows:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"0xc00 bytes for banner pixel data"),(0,o.kt)("li",{parentName:"ul"},"0x200 bytes for banner palette data"),(0,o.kt)("li",{parentName:"ul"},"0x400 bytes for icon pixel data"),(0,o.kt)("li",{parentName:"ul"},"0x200 bytes for icon palette data")),(0,o.kt)("p",null,"Note that if your palette data is less than 0x200 bytes long, you simply write what you have at the start of the 0x200 bytes.\nThe remaining reserved palette space is unused which is fine (TP does this with its banner)."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"See ",(0,o.kt)(l.Z,{to:"/docs/save-file/memory-card",mdxType:"Link"},"Memory Card")," for more info.")))}k.isMDXComponent=!0},2361:()=>{},4616:()=>{}}]);